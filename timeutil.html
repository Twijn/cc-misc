<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>timeutil - CC-Misc Utilities</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <style>
        :root {
            --bg: #ffffff;
            --text: #1a1a1a;
            --link: #0066cc;
            --border: #e0e0e0;
            --code-bg: #f5f5f5;
        }
        @media (prefers-color-scheme: dark) {
            :root {
                --bg: #1a1a1a;
                --text: #e0e0e0;
                --link: #4d9fff;
                --border: #333333;
                --code-bg: #2a2a2a;
            }
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text);
            background: var(--bg);
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            border-bottom: 2px solid var(--border);
            padding-bottom: 1.5rem;
            margin-bottom: 2rem;
        }
        .header h1 {
            margin-bottom: 1rem;
            font-size: 2.5rem;
        }
        .header p {
            font-size: 1.1rem;
            line-height: 1.8;
            opacity: 0.9;
        }
        h2 {
            margin-top: 3rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
            font-size: 1.8rem;
        }
        h3 {
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            font-size: 1.3rem;
        }
        code {
            background: var(--code-bg);
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.9em;
        }
        pre {
            padding: 1rem;
            border-radius: 4px;
            overflow-x: auto;
            margin: 1rem 0;
            border: 1px solid var(--border);
        }
        pre code {
            background: none;
            padding: 0;
            font-size: 0.95em;
        }
        .function:not(.token) {
            margin: 2rem 0;
            padding: 1.5rem;
            border: 1px solid var(--border);
            border-radius: 6px;
        }
        .function h3 {
            margin-top: 0;
        }
        .function > p {
            margin: 1rem 0;
            line-height: 1.7;
        }
        .params, .returns {
            margin-top: 1rem;
        }
        .params ul, .returns ul {
            list-style: none;
            padding-left: 0;
        }
        .params li, .returns li {
            padding: 0.5rem 0;
            padding-left: 1rem;
            border-left: 3px solid var(--border);
            margin: 0.25rem 0;
        }
        a {
            color: var(--link);
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        .back-link {
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
        }
        .install-section {
            background: var(--code-bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 1.5rem;
            margin: 2rem 0;
        }
        .install-section h2 {
            margin-top: 0;
            margin-bottom: 1rem;
            font-size: 1.5rem;
            border-bottom: none;
        }
        .install-cmd {
            background: var(--bg);
            border: 1px solid var(--border);
            padding: 0.75rem;
            border-radius: 4px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.9em;
            margin: 0.5rem 0;
            word-break: break-all;
        }
        .github-link {
            display: inline-block;
            padding: 0.5rem 1rem;
            background: var(--link);
            color: white;
            border: 1px solid var(--link);
            border-radius: 4px;
            text-decoration: none;
            font-size: 0.9em;
            transition: all 0.2s;
            font-family: inherit;
            line-height: 1.5;
            text-align: center;
            vertical-align: middle;
        }
        .github-link:hover {
            opacity: 0.85;
            text-decoration: none;
        }
        .install-controls {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            flex-wrap: wrap;
            margin-top: 1rem;
        }
        .copy-btn {
            display: inline-block;
            background: transparent;
            color: var(--link);
            border: 1px solid var(--link);
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s;
            font-family: inherit;
            line-height: 1.5;
            text-align: center;
            vertical-align: middle;
            text-decoration: none;
        }
        .copy-btn:hover {
            background: var(--link);
            color: white;
        }
        .copy-btn.copied {
            background: #28a745;
            border-color: #28a745;
            color: white;
        }
    </style>
</head>
<body>
    <div class="back-link"><a href="index.html">← Back to index</a></div>
    <div class="header">
        <h1>timeutil</h1>
        <p>A timing utility module for ComputerCraft that provides persistent interval management with two different timing modes: absolute time-based and accumulated runtime-based. Features: Absolute time intervals (based on system time), accumulated time intervals (based on actual runtime), persistent state across computer restarts, pretty-printed time formatting, manual execution control, and automatic interval management with run loop.</p>
    </div>
    
    <div class="install-section">
        <h2>Installation</h2>
        <p><strong>Recommended:</strong> Install via installergen (handles dependencies automatically):</p>
        <div class="install-cmd" id="installergen-cmd">wget run https://raw.githubusercontent.com/Twijn/cc-misc/main/util/installergen.lua timeutil</div>
        <div class="install-controls">
            <button class="copy-btn" onclick="copyCommand(this, 'installergen-cmd')">Copy Command</button>
            <a href="https://github.com/Twijn/cc-misc/blob/main/util/timeutil.lua" class="github-link" target="_blank">View on GitHub →</a>
        </div>
        <p style="margin-top: 1.5rem;"><strong>Alternative:</strong> Direct download via wget:</p>
        <div class="install-cmd" id="wget-cmd">wget https://raw.githubusercontent.com/Twijn/cc-misc/main/util/timeutil.lua</div>
        <div class="install-controls">
            <button class="copy-btn" onclick="copyCommand(this, 'wget-cmd')">Copy Command</button>
        </div>
    </div>
    
    <script>
        function copyCommand(btn, cmdId) {{
            const cmd = document.getElementById(cmdId).textContent;
            navigator.clipboard.writeText(cmd).then(() => {{
                const originalText = btn.textContent;
                btn.textContent = '✓ Copied!';
                btn.classList.add('copied');
                setTimeout(() => {{
                    btn.textContent = originalText;
                    btn.classList.remove('copied');
                }}, 2000);
            }}).catch(err => {{
                console.error('Failed to copy:', err);
                btn.textContent = '✗ Failed';
                setTimeout(() => {{
                    btn.textContent = 'Copy Command';
                }}, 2000);
            }});
        }}
    </script>
    <h2>Examples</h2>
    <pre><code class="language-lua">local timeutil = require("timeutil")
timeutil.every(function()
 print("Running backup...")
end, 600, "backup_last_run")
timeutil.everyLoaded(function()
 print("Heartbeat")
end, 30, "heartbeat_elapsed")
timeutil.run()</code></pre>
    <h2>Functions</h2>
    <div class='function'>
        <h3><code>module.every(cb, intervalTime, fileName)</code></h3>
        <a href='https://github.com/Twijn/cc-misc/blob/main/util/timeutil.lua#L45' target='_blank' style='font-size: 0.85em; opacity: 0.7;'>View source on GitHub</a>
        <p>Create an absolute time-based interval that runs based on system time This type of interval will "catch up" if the computer was offline, running immediately if the interval time has passed since the last recorded execution.</p>
        <div class='params'>
            <strong>Parameters:</strong>
            <ul>
                <li><code>cb</code> (function): Callback function to execute when interval triggers</li>
                <li><code>intervalTime</code> (number): Interval duration in seconds</li>
                <li><code>fileName</code> (string): File path to persist the last run timestamp</li>
            </ul>
        </div>
        <div class='returns'><strong>Returns:</strong> TimeutilInterval # Interval object with control methods</div>
    </div>
    <div class='function'>
        <h3><code>module.everyLoaded(cb, intervalTime, fileName)</code></h3>
        <a href='https://github.com/Twijn/cc-misc/blob/main/util/timeutil.lua#L112' target='_blank' style='font-size: 0.85em; opacity: 0.7;'>View source on GitHub</a>
        <p>Create a runtime-based interval that accumulates time only when the program is running This type of interval will NOT catch up after downtime, only counting actual runtime. Useful for operations that should happen after X seconds of actual program execution.</p>
        <div class='params'>
            <strong>Parameters:</strong>
            <ul>
                <li><code>cb</code> (function): Callback function to execute when interval triggers</li>
                <li><code>intervalTime</code> (number): Interval duration in seconds of actual runtime</li>
                <li><code>fileName</code> (string): File path to persist the accumulated elapsed time</li>
            </ul>
        </div>
        <div class='returns'><strong>Returns:</strong> TimeutilInterval # Interval object with control methods</div>
    </div>
    <div class='function'>
        <h3><code>module.run()</code></h3>
        <a href='https://github.com/Twijn/cc-misc/blob/main/util/timeutil.lua#L187' target='_blank' style='font-size: 0.85em; opacity: 0.7;'>View source on GitHub</a>
        <p>Start the main interval management loop This function blocks and continuously checks all registered intervals, executing them when their time has elapsed. Runs indefinitely until terminated.</p>
    </div>
    <div class='function'>
        <h3><code>module.getRelativeTime(sec)</code></h3>
        <a href='https://github.com/Twijn/cc-misc/blob/main/util/timeutil.lua#L200' target='_blank' style='font-size: 0.85em; opacity: 0.7;'>View source on GitHub</a>
        <p>Format a duration in seconds into a human-readable relative time string</p>
        <div class='params'>
            <strong>Parameters:</strong>
            <ul>
                <li><code>sec</code> (number): Duration in seconds</li>
            </ul>
        </div>
        <div class='returns'><strong>Returns:</strong> string # Formatted time string (e.g., "5.2 minutes", "1 day", "30 seconds")</div>
    </div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-lua.min.js"></script>
</html>
